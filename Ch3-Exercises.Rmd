---
title: "Chapter 3: Exercises"
output: html_notebook
---

# Setup
```{r}
library(tidyverse)
library(caret)
library(e1071)
```

# Qn 3.1

The UC Irvine Machine Learning Repository 6 contains a data set related to glass identification. The data consist of 214 glass samples labeled as one of seven class categories. There are nine predictors, including the refractive index and percentages of eight elements: Na, Mg, Al, Si, K, Ca, Ba, and Fe.

## Explore predictors

```{r}
library(mlbench)
data(Glass)
str(Glass)
```

Skewness
```{r}

skewValues <- Glass %>%
  select(-Type) %>%
  apply(MARGIN = 2, FUN = skewness)

# plot skewness
data_frame(name = names(skewValues), skew = skewValues) %>%
  ggplot(aes(x = name, y = skew)) + geom_bar(stat = "identity") + theme(axis.text.x = element_text(angle=90, hjust=1, vjust=.5))
```

```{r}
Glass %>% 
  select(-Type) %>%
  gather() %>%
  ggplot(aes(value)) + facet_wrap(~ key, scales = "free") + geom_density() + geom_rug()
```

Apply Box Cox transformation
```{r}
transform_data <- function(trans_list){
  # function for applying transformations to Glass dataset and plotting resulting predictor densities
  
  # applying transformations to Glass X
  trans <- preProcess(Glass, method = trans_list)
  Glass_trans <- predict(trans, Glass)
  # plot
  Glass_trans %>%
    select(-Type) %>%
    gather() %>%
    ggplot(aes(value)) + facet_wrap(~ key, scales = "free") + geom_density() + geom_rug()
}

transform_data(c("BoxCox", "center", "scale"))

```
Apply Yeo-Johnson transformation
```{r}
transform_data( c("YeoJohnson", "center", "scale") )

```

Spatial sign transformation

```{r}
transform_data( c("center", "scale","spatialSign"))
```
Exponential transformation

```{r}
transform_data( c("expoTrans", "center", "scale") )
```


Check correlations
```{r}
library(corrplot)
correlations <- Glass_trans %>%
  select(-Type) %>%
  cor()
# reorder to reveal clusters of highly correlated predictors
corrplot(correlations, order = "hclust")
```

```{r}
highcorr <- findCorrelation(correlations, cutoff = .75)
filteredGlass_trans <- Glass_trans[, -highcorr]
str(filteredGlass_trans)
```
Removed predictor
```{r}
names(Glass_trans)[highcorr]
```

